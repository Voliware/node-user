class Routes{static getUsers(){return fetch("/users").catch(e=>{console.error(e)})}static getUser(e){return fetch(`/user/${e}`).catch(e=>{console.error(e)})}static addUser({username:e,email:s,password:t}){let r=JSON.stringify({username:e,email:s,password:t});return fetch("/user",{method:"post",body:r}).catch(e=>{console.error(e)})}static deleteUser(e){return fetch(`/user/${e}`,{method:"delete"}).catch(e=>{console.error(e)})}static updateUser({username:e,email:s,password:{older:t,newer:r}}){let i=JSON.stringify({username:e,email:s,password:{older:t,newer:r}});return fetch("/user",{method:"put",body:i}).catch(e=>{console.error(e)})}static login({username:e,password:s}){let t=JSON.stringify({username:e,password:s});return fetch("/user/login",{method:"post",body:t}).catch(e=>{console.error(e)})}static loginWithCookie(){return fetch("/user/login",{method:"post"}).catch(e=>{console.error(e)})}static logout(){return fetch("/user/logout",{method:"post"}).catch(e=>{console.error(e)})}static register({username:e,email:s,password:t}){let r=JSON.stringify({username:e,email:s,password:t});return fetch("/user/register",{method:"post",body:r}).catch(e=>{console.error(e)})}static resetPassword({email:e}){let s=JSON.stringify({email:e});return fetch("/user/reset",{method:"post",body:s}).catch(e=>{console.error(e)})}}class LoginForm extends FormTemplate{constructor(){return super({submitRequest:Routes.login}),this}}customElements.define("template-user-login",LoginForm);class RegisterForm extends FormTemplate{constructor(){return super({submitRequest:Routes.register}),this}}customElements.define("template-user-register",RegisterForm);class ResetForm extends FormTemplate{constructor(){return super({submitRequest:Routes.resetPassword}),this}}customElements.define("template-user-reset",ResetForm);class User{constructor(){return this.username="",this.id=0,this.email="",this}}class UserTemplate extends Template{constructor(){return super({elements:{avatar:'[data-name="avatar"]',name:'[data-name="name"]',email:'[data-name="email"]',logout:'[name="logout"]'}}),this}attachHandlers(){return Template.on(this.elements.logout,"click",()=>{this.emit("logout")}),this}}customElements.define("template-user",UserTemplate);class UserApp extends Template{constructor(){return super(),this.wrapper=Template.selectFirst("template-user-app"),this.feedback=Template.selectFirst("template-feedback"),this.loginForm=Template.selectFirst("template-user-login"),this.registerForm=Template.selectFirst("template-user-register"),this.resetForm=Template.selectFirst("template-user-reset"),this.loginLink=Template.selectFirst(".user-login-link"),this.registerLink=Template.selectFirst(".user-register-link"),this.resetPasswordLink=Template.selectFirst(".user-reset-link"),this.user=new User,this.userElement=Template.selectFirst("template-user"),this.userElement.on("logout",()=>{this.logout()}),this.attachLoginFormHandlers(),this.attachRegisterFormHandlers(),this.attachResetFormHandlers(),Template.on(this.loginLink,"click",()=>{this.displayComponent("login"),this.displayLinks("login")}),Template.on(this.resetPasswordLink,"click",()=>{this.displayComponent("reset"),this.displayLinks("reset")}),Template.on(this.registerLink,"click",()=>{this.displayComponent("register"),this.displayLinks("register")}),this}attachLoginFormHandlers(){return this.loginForm.on("success",()=>{this.displayComponent("logout"),this.feedback.renderSuccess("Logged in successfully"),this.feedback.show()}),this.loginForm.on("fail",()=>{this.feedback.renderError("Failed to login"),this.feedback.show()}),this}attachRegisterFormHandlers(){return this.registerForm.on("success",()=>{this.displayComponent("logout"),this.feedback.renderSuccess("Registered successfully"),this.feedback.show()}),this.registerForm.on("fail",()=>{this.feedback.renderError("Failed to register"),this.feedback.show()}),this}attachResetFormHandlers(){return this.resetForm.on("success",()=>{this.feedback.renderSuccess("Reset password successfully"),this.feedback.show()}),this.resetForm.on("fail",()=>{this.feedback.renderError("Failed to reset password"),this.feedback.show()}),this}setUserData(e){return this.user.set(e),this}render(e){return this.userElement.render(e),this}display(e){return Template.display(this.wrapper,e),this}displayComponent(e){switch(e){case"reset":this.displayForm("reset"),this.displayLinks("reset");break;case"register":this.displayForm("register"),this.displayLinks("register");break;case"logout":this.displayForm("logout"),this.displayLinks("logout");break;case"login":default:this.displayForm("login"),this.displayLinks("login")}return this}displayForm(e){switch(e){case"reset":this.loginForm.hide(),this.registerForm.hide(),this.userElement.hide(),this.resetForm.show();break;case"register":this.resetForm.hide(),this.loginForm.hide(),this.userElement.hide(),this.registerForm.show();break;case"logout":this.loginForm.hide(),this.registerForm.hide(),this.resetForm.hide(),this.userElement.show();break;case"login":default:this.resetForm.hide(),this.registerForm.hide(),this.userElement.hide(),this.loginForm.show()}return this}displayLinks(e){switch(e){case"register":Template.hide(this.registerLink),Template.show(this.resetPasswordLink),Template.show(this.loginLink);break;case"reset":Template.hide(this.resetPasswordLink),Template.show(this.loginLink),Template.show(this.registerLink);break;case"logout":Template.hide(this.registerLink),Template.hide(this.resetPasswordLink),Template.hide(this.loginLink);break;case"login":default:Template.hide(this.loginLink),Template.show(this.registerLink),Template.show(this.resetPasswordLink)}return this}async loginWithSessionId(){200===(await Routes.loginWithCookie()).status?this.displayComponent("logout"):this.displayComponent("login")}async logout(){200===(await Routes.logout()).status&&this.displayComponent("login")}initialize(){return this.loginWithSessionId()}}customElements.define("template-user-app",UserApp);